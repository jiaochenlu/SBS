<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiment Detail - Search NDCG Experiment</title>
    <link rel="stylesheet" href="experiment-detail.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <!-- Á¨¨‰∏ÄË°åÔºöBackÊåâÈíÆÔºàÂ∑¶‰∏äÔºâ + Áî®Êà∑ÂàáÊç¢Âô®ÔºàÂè≥‰∏äÔºâ -->
            <div class="header-row-1">
                <button class="btn-header back-btn" onclick="window.location.href='experiment-list.html'">
                    ‚Üê Back
                </button>
                <div class="user-switcher">
                    <div class="current-user" onclick="toggleUserDropdown()">
                        <div class="user-avatar" id="currentUserAvatar">JS</div>
                        <div class="user-info">
                            <div class="user-name" id="currentUserName">Loading...</div>
                            <div class="user-role" id="currentUserRole">...</div>
                        </div>
                        <span class="dropdown-arrow">‚ñº</span>
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <!-- Áî®Êà∑ÈÄâÈ°πÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
            
            <!-- Á¨¨‰∫åË°åÔºöÊ†áÈ¢òÔºàBackÊåâÈíÆ‰∏ãÊñπÔºâ + Êìç‰ΩúÊåâÈíÆÁªÑÔºàÁî®Êà∑ÂàáÊç¢Âô®‰∏ãÊñπÔºå‰∏éÊ†áÈ¢òÂêå‰∏ÄÊ∞¥Âπ≥Á∫øÔºâ -->
            <div class="header-row-2">
                <div class="experiment-title-section">
                    <h1 class="experiment-title" id="experimentTitle" title="Loading...">Loading...</h1>
                </div>
                <div class="header-actions">
                    <button class="btn-header" onclick="toggleConfigurationPanel()" id="configBtn" title="View configuration">Config</button>
                    <button class="btn-header" onclick="cloneExperiment()" id="cloneBtn" title="Clone experiment">Clone</button>
                    <button class="btn-header" onclick="deleteExperiment()" id="deleteBtn" title="Delete experiment">Delete</button>
                </div>
            </div>
            
            <!-- Á¨¨‰∏âË°åÔºöÂÖÉÊï∞ÊçÆÔºàÊ†áÈ¢ò‰∏ãÊñπÔºåÂ±Ö‰∏≠Ôºâ -->
            <div class="header-row-3">
                <div class="experiment-meta">
                    <span class="status-badge" id="experimentStatus">Loading...</span>
                    <span id="experimentCreated">Created: Loading...</span>
                    <span id="experimentOwner">Owner: Loading...</span>
                    <span id="experimentQueryCount">Loading queries...</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Content Wrapper with matching background -->
    <div class="content-wrapper">
        <!-- Overview Section -->
        <div class="overview-section">
            <div class="content-container">
                <!-- Progress Section -->
                <div class="section-card progress-overview-card">
                    <div class="section-header progress-header">
                        <h3>Progress Overview</h3>
                        <div class="progress-percentage" id="totalQueriesDisplay">Loading Total Queries</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar-segmented">
                            <div class="progress-segment completed" id="progressCompleted" style="width: 0%" title="Loading..."></div>
                            <div class="progress-segment in-progress" id="progressInProgress" style="width: 0%" title="Loading..."></div>
                            <div class="progress-segment not-started" id="progressNotStarted" style="width: 0%" title="Loading..."></div>
                        </div>
                        <div class="progress-stats-row">
                            <div class="progress-stats">
                                <div class="progress-stat-item completed">
                                    <span class="stat-dot"></span>
                                    <span class="stat-text" id="completedStat">Loading Completed</span>
                                </div>
                                <div class="progress-stat-item in-progress">
                                    <span class="stat-dot"></span>
                                    <span class="stat-text" id="inProgressStat">Loading In Progress</span>
                                </div>
                                <div class="progress-stat-item not-started">
                                    <span class="stat-dot"></span>
                                    <span class="stat-text" id="notStartedStat">Loading Not Started</span>
                                </div>
                            </div>
                            <div class="judges-info">
                                <span class="judges-icon">üë•</span>
                                <span class="stat-text" id="judgesCount">Loading Judges</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="tab-navigation">
            <div class="tab-container">
                <button class="tab-button active" data-tab="queries" onclick="switchTab('queries')">
                    Queries
                    <span class="tab-badge" id="queriesTabBadge">0</span>
                </button>
                <button class="tab-button" data-tab="results" onclick="switchTab('results')">
                    Results
                </button>
                <button class="tab-button" data-tab="members" onclick="switchTab('members')">
                    Members
                    <span class="tab-badge" id="membersTabBadge">0</span>
                </button>
            </div>
        </div>

        <!-- Main Content with Right Panel Layout -->
        <div class="main-content-wrapper">
            <div class="main-content">
        
        <!-- Queries Tab -->
        <div id="queries-tab" class="tab-content active">
            <div class="content-container">
                <div class="section-header">
                    <div class="header-left">
                        <h3>Query Management</h3>
                        <div class="header-actions">
                            <button class="btn-primary" id="assignJudgesBtn" onclick="assignQueries()" disabled>Assign Judges</button>
                            <button class="btn-secondary" onclick="importQueries()">Import Queries</button>
                        </div>
                    </div>
                </div>

                <!-- Task Type Sidebar and Query Content Layout -->
                <div class="query-management-layout">
                    <!-- Task Type Sidebar (only for ad hoc experiments) -->
                    <div class="task-type-sidebar" id="taskTypeSidebar" style="display: none;">
                        <div class="sidebar-header">
                            <h4>Task Types</h4>
                            <div class="sidebar-actions">
                                <label class="select-all-task-types">
                                    <input type="checkbox" id="selectAllTaskTypes" onchange="toggleSelectAllTaskTypes()">
                                    <span>All</span>
                                </label>
                                <button class="clear-filter-btn" onclick="clearTaskTypeFilter()" title="Show all queries">
                                    Clear Filter
                                </button>
                            </div>
                        </div>
                        <div class="task-type-list" id="taskTypeList">
                            <!-- Task types will be dynamically loaded here -->
                        </div>
                    </div>

                    <!-- Main Query Content -->
                    <div class="query-content-area">
                        <!-- Filters and Search -->
                        <div class="filters-section">
                            <div class="search-box">
                                <input type="text" placeholder="Search queries..." class="search-input">
                                <button class="search-btn">üîç</button>
                            </div>
                            <div class="filter-buttons">
                                <select class="filter-select">
                                    <option value="">All Status</option>
                                    <option value="completed">Completed</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="not-started">Not Started</option>
                                </select>
                                <select class="filter-select">
                                    <option value="">All Judges</option>
                                    <option value="john-smith">John Smith</option>
                                    <option value="alice-miller">Alice Miller</option>
                                    <option value="robert-johnson">Robert Johnson</option>
                                </select>
                            </div>
                        </div>

                        <!-- Query List -->
                        <div class="query-list-container">
                            <div class="query-list-header" id="queryListHeader">
                                <!-- Header will be rendered by JS -->
                            </div>
                            
                            <div class="query-list-body" id="queryListBody">
                                <!-- Query items will be dynamically loaded here -->
                            </div>
                        </div>

                        <!-- Pagination -->
                        <div class="pagination">
                            <button class="pagination-btn" onclick="previousPage()">‚Üê Previous</button>
                            <span class="pagination-info">Page 1 of 10</span>
                            <button class="pagination-btn" onclick="nextPage()">Next ‚Üí</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Members Tab -->
        <div id="members-tab" class="tab-content">
            <div class="content-container">
                <div class="section-header">
                    <h3>Team Members</h3>
                    <div class="header-actions">
                        <button class="btn-primary" onclick="addMember()">Add Member</button>
                        <button class="btn-secondary" onclick="manageMembers()">Manage Members</button>
                    </div>
                </div>

                <!-- Members List -->
                <div class="members-grid">
                    <!-- Members will be dynamically loaded here -->
                </div>

                <!-- Add Member Modal -->
                <div id="addMemberModal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Add New Member</h3>
                            <button class="modal-close" onclick="closeAddMemberModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" class="form-control" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select class="form-control" id="roleSelect">
                                    <!-- Options will be populated dynamically based on current user role -->
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-secondary" onclick="closeAddMemberModal()">Cancel</button>
                            <button class="btn-primary" onclick="addMemberSubmit()">Add Member</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Tab -->
        <div id="results-tab" class="tab-content">
            <div class="content-container">
                <div class="section-header">
                    <h3>Annotation Results</h3>
                    <div class="header-actions">
                        <button class="btn-secondary" onclick="downloadReport()">Download Report</button>
                        <button class="btn-primary" onclick="exportData()">Export Data</button>
                    </div>
                </div>

                <!-- Results Summary -->
                <div class="results-summary">
                    <div class="summary-card">
                        <div class="summary-title">Inter-Annotator Agreement</div>
                        <div class="summary-value">87.3%</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Average Completion Time</div>
                        <div class="summary-value">2.3 min</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-title">Quality Score</div>
                        <div class="summary-value">9.1/10</div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-container">
                        <h4>Completion Progress Over Time</h4>
                        <div class="chart-placeholder">üìà Chart will be rendered here</div>
                    </div>
                    <div class="chart-container">
                        <h4>Answer Distribution</h4>
                        <div class="chart-placeholder">üìä Chart will be rendered here</div>
                    </div>
                </div>
            </div>
        </div>

            <!-- Right Panel for Configuration -->
            <div class="right-panel" id="configurationPanel">
                <div class="right-panel-header">
                    <h3>Experiment Configuration</h3>
                    <button class="panel-close" onclick="toggleConfigurationPanel()">&times;</button>
                </div>
                <div class="right-panel-body">
                    <div class="config-section">
                        <h4>Experiment Type</h4>
                        <div class="config-item">
                            <span class="config-label">Selected Type:</span>
                            <span class="config-value" id="configExperimentType">Loading...</span>
                        </div>
                    </div>

                    <div class="config-section">
                        <h4>Basic Information</h4>
                        <div class="config-item">
                            <span class="config-label">Experiment Name:</span>
                            <span class="config-value" id="configExperimentName">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Experiment Description:</span>
                            <span class="config-value" id="configExperimentDescription">Loading...</span>
                        </div>
                    </div>

                    <div class="config-section">
                        <h4>Labeling Data</h4>
                        <div class="config-item">
                            <span class="config-label">Data Schema:</span>
                            <span class="config-value" id="configDataSchema">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Data Source:</span>
                            <span class="config-value" id="configDataSource">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Query Set Selection:</span>
                            <span class="config-value" id="configQuerySetSelection">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Query Set File:</span>
                            <span class="config-value" id="configQuerySetFile">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Control Profile:</span>
                            <span class="config-value" id="configControlProfile">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Treatment Profile:</span>
                            <span class="config-value" id="configTreatmentProfile">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Data Fields Display:</span>
                            <span class="config-value" id="configDataFieldsDisplay">Loading...</span>
                        </div>
                    </div>

                    <div class="config-section">
                        <h4>Judgement Questions</h4>
                        <div id="judgementQuestionsContainer">
                            <div class="config-item">
                                <span class="config-label">Loading...</span>
                                <span class="config-value">Loading...</span>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h4>Additional Settings</h4>
                        <div class="config-item">
                            <span class="config-label">Blind Test:</span>
                            <span class="config-value" id="configBlindTest">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Allow Any to Judge:</span>
                            <span class="config-value" id="configAllowAnyToJudge">Loading...</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Judgement Guide:</span>
                            <span class="config-value" id="configJudgementGuide">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="experiment-detail.js"></script>
    <script>
        // ËÆ°ÁÆóÊü•ËØ¢‰∏≠ÂÆûÈôÖÂèÇ‰∏éÁöÑunique judgesÊï∞Èáè
        function calculateUniqueJudges(exp) {
            if (!exp || !exp.queries) {
                return '0 Judges';
            }
            
            const uniqueJudges = new Set();
            exp.queries.forEach(query => {
                if (query.assignments) {
                    query.assignments.forEach(assignment => {
                        if (assignment.judge && assignment.judge.name) {
                            uniqueJudges.add(assignment.judge.name);
                        }
                    });
                }
            });
            
            console.log('üìä calculateUniqueJudges: Found', uniqueJudges.size, 'unique judges in assignments');
            return `${uniqueJudges.size} Judges`;
        }
        
        // ËÆ°ÁÆóËøõÂ∫¶ÁªüËÆ°ÁöÑËæÖÂä©ÂáΩÊï∞
        function calculateProgressStats(exp) {
            if (!exp || !exp.queries) {
                return {
                    completed: '0 Completed (0%)',
                    inProgress: '0 In Progress (0%)',
                    notStarted: '0 Not Started (0%)'
                };
            }
            
            const queries = exp.queries;
            let completedCount = 0, inProgressCount = 0, notStartedCount = 0;
            
            queries.forEach(query => {
                const assignments = query.assignments || [];
                const completedAssignments = assignments.filter(a => a.status === 'completed').length;
                const totalAssignments = assignments.length;
                
                if (completedAssignments === totalAssignments && totalAssignments > 0) {
                    completedCount++;
                } else if (completedAssignments > 0) {
                    inProgressCount++;
                } else {
                    notStartedCount++;
                }
            });
            
            const total = queries.length;
            const completedPercentage = total > 0 ? Math.round((completedCount / total) * 100) : 0;
            const inProgressPercentage = total > 0 ? Math.round((inProgressCount / total) * 100) : 0;
            const notStartedPercentage = total > 0 ? Math.round((notStartedCount / total) * 100) : 0;
            
            return {
                completed: `${completedCount} Completed (${completedPercentage}%)`,
                inProgress: `${inProgressCount} In Progress (${inProgressPercentage}%)`,
                notStarted: `${notStartedCount} Not Started (${notStartedPercentage}%)`,
                completedCount,
                inProgressCount,
                notStartedCount,
                completedPercentage,
                inProgressPercentage,
                notStartedPercentage
            };
        }
        
        // Áî®Êà∑‰∏ãÊãâËèúÂçïÁîüÊàêÂáΩÊï∞
        function generateUserDropdown() {
            // Ê£ÄÊü•Êï∞ÊçÆÊ∫êÔºà‰ºòÂÖà‰ΩøÁî®ÂÖ®Â±ÄÂèòÈáèÔºåÁÑ∂ÂêéÊòØwindow.expÔºâ
            const expData = window.experimentData || window.exp;
            
            if (!expData || !expData.members) {
                console.warn('‚ö†Ô∏è No experiment data or members available for user dropdown');
                console.warn('  - window.experimentData:', window.experimentData);
                console.warn('  - window.exp:', window.exp);
                return;
            }
            
            const dropdown = document.getElementById('userDropdown');
            if (!dropdown) {
                console.warn('‚ö†Ô∏è User dropdown element not found');
                return;
            }
            
            console.log('üîÑ Generating user dropdown with data:', expData.members);
            dropdown.innerHTML = '';
            
            expData.members.forEach(member => {
                const userOption = document.createElement('div');
                userOption.className = 'user-option';
                userOption.onclick = () => {
                    console.log('üë§ User clicked:', member.name);
                    if (window.switchUser) {
                        window.switchUser(member.id);
                    } else {
                        console.warn('‚ö†Ô∏è switchUser function not available');
                    }
                };
                
                userOption.innerHTML = `
                    <div class="user-avatar">${member.initials}</div>
                    <div class="user-info">
                        <div class="user-name">${member.name}</div>
                        <div class="user-role">${member.role.charAt(0).toUpperCase() + member.role.slice(1)}</div>
                    </div>
                `;
                
                dropdown.appendChild(userOption);
            });
            
            console.log('‚úÖ User dropdown generated with', expData.members.length, 'members');
        }

        // Immediate config loading and UI update
        (async function() {
            console.log('üöÄ Immediate config loader starting...');
            
            try {
                // Fetch config immediately
                const response = await fetch('./experiment-config-merged.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const config = await response.json();
                console.log('‚úÖ Config loaded immediately:', config);
                
                // Ëé∑ÂèñÂΩìÂâçÂÆûÈ™åÊï∞ÊçÆ
                function getCurrentExperiment() {
                    // Â∞ùËØï‰ªéURLÂèÇÊï∞Ëé∑ÂèñÂÆûÈ™åID
                    const urlParams = new URLSearchParams(window.location.search);
                    const experimentId = urlParams.get('id');
                    
                    if (experimentId) {
                        const experiment = config.experiments.find(exp => exp.id === experimentId);
                        if (experiment) {
                            console.log(`‚úÖ Found experiment by ID: ${experimentId}`);
                            return experiment;
                        }
                    }
                    
                    // Â¶ÇÊûúÊ≤°ÊúâÊâæÂà∞ÊàñÊ≤°ÊúâÊåáÂÆöIDÔºåËøîÂõûÁ¨¨‰∏Ä‰∏™ÂÆûÈ™å
                    console.log('‚ö†Ô∏è No experiment ID specified or not found, using first experiment');
                    return config.experiments[0];
                }
                
                const exp = getCurrentExperiment();
                window.exp = exp; // ËÆ©ÂêéÁª≠ËÑöÊú¨ÂèØÁõ¥Êé•ËÆøÈóÆ
                window.experimentData = exp; // ‰πüËÆæÁΩÆËøô‰∏™ÂÖ®Â±ÄÂèòÈáè‰ª•ÂÖºÂÆπJSÊñá‰ª∂
                
                console.log(`üìã Loading experiment: ${exp.name} (${exp.id})`);
                console.log(`üìã Set global variables - exp:`, exp, 'experimentData:', window.experimentData);
                
                // Âª∂ËøüÁîüÊàêÁî®Êà∑‰∏ãÊãâËèúÂçïÔºåÁ°Æ‰øùDOMÂíåÊï∞ÊçÆÈÉΩÂ∞±Áª™
                setTimeout(() => {
                    console.log('üîÑ Generating user dropdown...');
                    generateUserDropdown();
                    
                    // Á°Æ‰øùMembers tab badgeÊòæÁ§∫Ê≠£Á°ÆÁöÑÂÄº
                    const membersTabBadge = document.getElementById('membersTabBadge');
                    if (membersTabBadge && exp.members) {
                        membersTabBadge.textContent = exp.members.length;
                        console.log('üîß Force updated membersTabBadge to:', exp.members.length);
                    }
                    
                    // ÂêåÊó∂Á°Æ‰øùjudges countÊòæÁ§∫Ê≠£Á°ÆÁöÑÂÄº
                    const judgesCountEl = document.getElementById('judgesCount');
                    if (judgesCountEl && exp.queries) {
                        const correctJudgesCount = calculateUniqueJudges(exp);
                        judgesCountEl.textContent = correctJudgesCount;
                        console.log('üîß Force updated judgesCount to:', correctJudgesCount);
                    }
                }, 100);
                
                // È¢ùÂ§ñÁöÑÊ£ÄÊü•ÔºåÂú®Êõ¥ÈïøÁöÑÂª∂ËøüÂêéÂÜçÊ¨°Á°Æ‰øùÊ≠£Á°ÆÂÄº
                setTimeout(() => {
                    const membersTabBadge = document.getElementById('membersTabBadge');
                    if (membersTabBadge && exp.members) {
                        const currentValue = membersTabBadge.textContent;
                        const expectedValue = exp.members.length;
                        
                        console.log('üîç Final check - Current members badge:', currentValue, 'Expected:', expectedValue);
                        
                        if (currentValue !== expectedValue.toString()) {
                            membersTabBadge.textContent = expectedValue;
                            console.log('üîß Corrected membersTabBadge from', currentValue, 'to', expectedValue);
                        }
                    }
                    
                    // ÊúÄÁªàÊ£ÄÊü•judges count
                    const judgesCountEl = document.getElementById('judgesCount');
                    if (judgesCountEl && exp.queries) {
                        const currentJudgesValue = judgesCountEl.textContent;
                        const expectedJudgesValue = calculateUniqueJudges(exp);
                        
                        console.log('üîç Final check - Current judges count:', currentJudgesValue, 'Expected:', expectedJudgesValue);
                        
                        if (currentJudgesValue !== expectedJudgesValue) {
                            judgesCountEl.textContent = expectedJudgesValue;
                            console.log('üîß Corrected judgesCount from', currentJudgesValue, 'to', expectedJudgesValue);
                        }
                    }
                }, 500);
                
                // Update all hardcoded "Loading..." immediately
                const updates = [
                    { id: 'experimentTitle', value: exp.name, title: exp.name },
                    { id: 'experimentStatus', value: exp.status.charAt(0).toUpperCase() + exp.status.slice(1) },
                    { id: 'experimentCreated', value: `Created: ${exp.createdAt}` },
                    { id: 'experimentOwner', value: `Owner: ${exp.owner.name}` },
                    { id: 'experimentQueryCount', value: `${exp.queries ? exp.queries.length : 0} queries` },
                    { id: 'totalQueriesDisplay', value: `${exp.queries ? exp.queries.length : 0} Total Queries` },
                    { id: 'completedStat', value: calculateProgressStats(exp).completed },
                    { id: 'inProgressStat', value: calculateProgressStats(exp).inProgress },
                    { id: 'notStartedStat', value: calculateProgressStats(exp).notStarted },
                    { id: 'judgesCount', value: calculateUniqueJudges(exp) },
                    { id: 'configExperimentType', value: exp.configuration.experimentType },
                    { id: 'configExperimentName', value: exp.name },
                    { id: 'configExperimentDescription', value: exp.description },
                    { id: 'configDataSchema', value: exp.configuration.dataSchema },
                    { id: 'configDataSource', value: exp.configuration.dataSource },
                    { id: 'configQuerySetSelection', value: exp.configuration.querySetSelection },
                    { id: 'configQuerySetFile', value: `${exp.configuration.querySetFile.name} (${exp.configuration.querySetFile.queryCount} queries)` },
                    { id: 'configControlProfile', value: exp.configuration.controlProfile },
                    { id: 'configTreatmentProfile', value: exp.configuration.treatmentProfile },
                    { id: 'configDataFieldsDisplay', value: exp.configuration.dataFieldsDisplay },
                    { id: 'configBlindTest', value: exp.configuration.additionalSettings.blindTest ? 'Enabled' : 'Disabled' },
                    { id: 'configAllowAnyToJudge', value: exp.configuration.additionalSettings.allowAnyToJudge ? 'Enabled' : 'Disabled' },
                    { id: 'configJudgementGuide', value: exp.configuration.additionalSettings.judgementGuide },
                    { id: 'queriesTabBadge', value: exp.queries.length },
                    { id: 'membersTabBadge', value: exp.members.length }
                ];
                
                // Apply all updates
                updates.forEach(update => {
                    const element = document.getElementById(update.id);
                    if (element) {
                        element.textContent = update.value;
                        // Â¶ÇÊûúÊúâtitleÂ±ûÊÄßÔºå‰πüÊõ¥Êñ∞ÂÆÉÔºàÁî®‰∫étooltipÔºâ
                        if (update.title) {
                            element.setAttribute('title', update.title);
                        }
                        console.log(`‚úÖ Updated ${update.id} to: ${update.value}`);
                    } else {
                        console.warn(`‚ùå Element ${update.id} not found`);
                    }
                });
                
                // Update progress bars using calculated stats
                const progressStats = calculateProgressStats(exp);
                
                const progressCompleted = document.getElementById('progressCompleted');
                if (progressCompleted) {
                    progressCompleted.style.width = `${progressStats.completedPercentage}%`;
                    progressCompleted.title = progressStats.completed;
                }
                
                const progressInProgress = document.getElementById('progressInProgress');
                if (progressInProgress) {
                    progressInProgress.style.width = `${progressStats.inProgressPercentage}%`;
                    progressInProgress.title = progressStats.inProgress;
                }
                
                const progressNotStarted = document.getElementById('progressNotStarted');
                if (progressNotStarted) {
                    progressNotStarted.style.width = `${progressStats.notStartedPercentage}%`;
                    progressNotStarted.title = progressStats.notStarted;
                }
                
                // Update experiment status badge class
                const statusElement = document.getElementById('experimentStatus');
                if (statusElement) {
                    statusElement.className = `status-badge status-${exp.status}`;
                }
                
                console.log('üéâ All UI elements updated successfully!');
                console.log('üìä Members count from HTML update:', exp.members.length);
                
                // Load queries into the query list
                console.log('üìã Loading queries...');
                const queryListBody = document.getElementById('queryListBody');
                if (queryListBody && exp.queries) {
                    queryListBody.innerHTML = ''; // Clear existing content
                    
                    exp.queries.forEach(query => {
                        const row = document.createElement('div');
                        row.className = 'query-row';
                        
                        // Calculate progress for this query
                        const assignments = query.assignments || [];
                        const completedAssignments = assignments.filter(a => a.status === 'completed').length;
                        const totalAssignments = assignments.length;
                        
                        let overallStatus = 'not-started';
                        if (completedAssignments === totalAssignments && totalAssignments > 0) {
                            overallStatus = 'completed';
                        } else if (completedAssignments > 0) {
                            overallStatus = 'in-progress';
                        }
                        
                        const overallProgress = totalAssignments > 0 ? Math.round((completedAssignments / totalAssignments) * 100) : 0;
                        
                        // Create assignees display
                        const assigneesHtml = assignments.length > 0 ?
                            assignments.map(assignment => `
                                <div class="assignment-item" title="${assignment.judge.name} - ${assignment.status}">
                                    <div class="assignee-avatar ${assignment.status}">${assignment.judge.initials}</div>
                                    <div class="assignment-status-dot ${assignment.status}"></div>
                                </div>
                            `).join('') :
                            '<div class="no-assignments">Not assigned</div>';
                        
                        // Calculate last judged time
                        const completedAssignmentsForTime = assignments.filter(a => a.status === 'completed');
                        let lastJudgedAt = '--';
                        if (completedAssignmentsForTime.length > 0) {
                            const latestCompletion = completedAssignmentsForTime.reduce((latest, current) => {
                                const currentTime = new Date(current.completedAt).getTime();
                                const latestTime = new Date(latest.completedAt).getTime();
                                return currentTime > latestTime ? current : latest;
                            });
                            
                            const date = new Date(latestCompletion.completedAt);
                            lastJudgedAt = date.getFullYear() + '-' +
                                          String(date.getMonth() + 1).padStart(2, '0') + '-' +
                                          String(date.getDate()).padStart(2, '0') + ' ' +
                                          String(date.getHours()).padStart(2, '0') + ':' +
                                          String(date.getMinutes()).padStart(2, '0') + ':' +
                                          String(date.getSeconds()).padStart(2, '0');
                        }
                        
                        row.innerHTML = `
                            <div class="checkbox-column">
                                <input type="checkbox" value="${query.id}" onchange="updateSelectedQueries()">
                            </div>
                            <div class="query-column">
                                <div class="query-text">${query.text}</div>
                                <div class="query-meta">#${query.id}</div>
                            </div>
                            <div class="task-type-column">
                                <div class="task-type-text">${query.taskType || 'N/A'}</div>
                            </div>
                            <div class="assignments-column">
                                <div class="assignments-container">
                                    ${assigneesHtml}
                                </div>
                                <div class="assignment-summary">
                                    ${totalAssignments} assigned | ${completedAssignments} completed
                                </div>
                            </div>
                            <div class="status-column">
                                <span class="status-badge status-${overallStatus}">${overallStatus}</span>
                            </div>
                            <div class="last-judged-column">
                                ${lastJudgedAt}
                            </div>
                        `;
                        
                        queryListBody.appendChild(row);
                    });
                    
                    console.log(`‚úÖ Loaded ${exp.queries.length} queries`);
                } else {
                    console.warn('‚ùå queryListBody element not found or no queries in config');
                }
            
                
            } catch (error) {
                console.error('‚ùå Immediate config loading failed:', error);
                // Set fallback values if config loading fails
                const fallbackUpdates = [
                    { id: 'experimentTitle', value: 'Search NDCG Experiment (Fallback)' },
                    { id: 'experimentStatus', value: 'Active' },
                    { id: 'experimentCreated', value: 'Created: March 15, 2024' },
                    { id: 'experimentOwner', value: 'Owner: John Smith' },
                    { id: 'experimentQueryCount', value: '50 queries' },
                    { id: 'totalQueriesDisplay', value: '50 Total Queries' },
                    { id: 'completedStat', value: '30 Completed (60%)' },
                    { id: 'inProgressStat', value: '10 In Progress (20%)' },
                    { id: 'notStartedStat', value: '10 Not Started (20%)' },
                    { id: 'judgesCount', value: '3 Judges' }
                ];
                
                fallbackUpdates.forEach(update => {
                    const element = document.getElementById(update.id);
                    if (element) {
                        element.textContent = update.value;
                    }
                });
            }
        })();
    </script>
</body>
</html>
